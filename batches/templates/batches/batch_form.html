{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{% if form.instance.pk %}Edit Batch{% else %}Add New Batch{% endif %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f9; padding: 30px; }
        .card { background: white; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 20px; width: 600px; margin: auto; }
        h2 { background: #28a745; color: white; padding: 10px; border-radius: 8px; text-align: center; }
        button, a { display: block; width: 100%; text-align: center; margin-top: 10px; padding: 10px; border-radius: 6px; text-decoration: none; font-weight: bold; }
        button { background: #28a745; color: white; border: none; }
        button:hover { background: #218838; }
        a { background: #6c757d; color: white; }
        a:hover { background: #5a6268; }
        form p { margin-bottom: 12px; }
        input, select, textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="card">
        <h2>{% if form.instance.pk %}Edit Batch{% else %}Add New Batch{% endif %}</h2>

        <form id="batchForm" method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">üíæ Save Batch</button>
        </form>

        <a href="{% url 'batches:batch_list' %}">‚Ü©Ô∏è Back</a>
    </div>

    <script>
    document.getElementById("batchForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);

        try {
            const response = await fetch("", {
                method: "POST",
                headers: { "X-Requested-With": "XMLHttpRequest" },
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                Toastify({
                    text: data.message,
                    backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
                    duration: 3000
                }).showToast();

                form.reset();
            } else {
                let errors = "";
                for (const [key, val] of Object.entries(data.errors)) {
                    errors += `${key}: ${val.join(", ")}\n`;
                }
                Toastify({
                    text: errors,
                    backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)",
                    duration: 5000
                }).showToast();
            }
        } catch (error) {
            console.error("Error:", error);
            Toastify({
                text: "Something went wrong!",
                backgroundColor: "red",
                duration: 3000
            }).showToast();
        }
    });
    </script>
</body>
</html>

